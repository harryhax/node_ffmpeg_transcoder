<main class="container py-4">
  <div id="ffmpeg-warning" class="alert alert-danger d-none" role="alert"></div>

  <div class="card mb-4">
    <div class="card-header fw-bold d-flex align-items-center gap-2">
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="bi bi-folder2-open" viewBox="0 0 16 16" aria-hidden="true" focusable="false">
        <path d="M1 3.5A1.5 1.5 0 0 1 2.5 2H6l1 1h6.5A1.5 1.5 0 0 1 15 4.5v.528a.5.5 0 0 1-.254.434.5.5 0 0 1-.438.032L13.5 5H2.118l-.439 1.757A1.5 1.5 0 0 0 1.5 8h11.757a1.5 1.5 0 0 0 1.455-1.14l.273-1.092A1.5 1.5 0 0 0 13.53 4H2.5A1.5 1.5 0 0 1 1 2.5z"/>
        <path d="M1 8.5A1.5 1.5 0 0 1 2.5 7h10.757a1.5 1.5 0 0 1 1.455 1.86l-.608 2.43A2.5 2.5 0 0 1 11.678 13H3.322a2.5 2.5 0 0 1-2.426-1.71l-.608-2.43A1.5 1.5 0 0 1 1 8.5"/>
      </svg>
      <span>Root Folder</span>
    </div>
    <div class="card-body">
      <div class="row g-3 align-items-end">
        <div class="col-12">
          <label for="root-picker" class="form-label">Root folder</label>
          <input id="root" type="hidden" form="audit-form" name="root" value="./smoke-fixtures" />
          <div class="form-text">Choose a server folder to scan. Use “Go Back (..)” to move up.</div>
          <div class="d-flex gap-2 mt-2">
            <select id="root-picker" class="form-select">
              <option value="./smoke-fixtures" selected>./smoke-fixtures</option>
            </select>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="card mb-4">
    <div class="card-header fw-bold d-flex align-items-center justify-content-between gap-2">
      <span class="d-inline-flex align-items-center gap-2">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="bi bi-sliders" viewBox="0 0 16 16" aria-hidden="true" focusable="false">
          <path fill-rule="evenodd" d="M11.5 2a.5.5 0 0 1 .5.5V3h3a.5.5 0 0 1 0 1h-3v.5a.5.5 0 0 1-1 0V4h-7v.5a.5.5 0 0 1-1 0V4H1a.5.5 0 0 1 0-1h2V2.5a.5.5 0 0 1 1 0V3h7v-.5a.5.5 0 0 1 .5-.5M4 8a.5.5 0 0 1 .5.5V9h10a.5.5 0 0 1 0 1h-10v.5a.5.5 0 0 1-1 0V10H1a.5.5 0 0 1 0-1h2.5v-.5A.5.5 0 0 1 4 8m7.5 4a.5.5 0 0 1 .5.5V13h3a.5.5 0 0 1 0 1h-3v.5a.5.5 0 0 1-1 0V14h-10a.5.5 0 0 1 0-1h10v-.5a.5.5 0 0 1 .5-.5"/>
        </svg>
        <span>Transcode Settings</span>
      </span>
      <button
        id="transcode-settings-toggle"
        class="btn btn-sm btn-outline-secondary"
        type="button"
        data-bs-toggle="collapse"
        data-bs-target="#transcode-settings-collapse"
        aria-expanded="true"
        aria-controls="transcode-settings-collapse"
      >Collapse</button>
    </div>
    <div id="transcode-settings-collapse" class="collapse show">
      <div class="card-body">
      <form id="audit-form" class="row g-3 align-items-end">
        <div class="col-md-3">
          <label for="videoCodec" class="form-label">Video codec</label>
          <select id="videoCodec" class="form-select" name="videoCodec">
            <option value="">Any</option>
          </select>
        </div>
        <div class="col-md-3">
          <label for="videoBitrate" class="form-label">Video bitrate</label>
          <div class="input-group">
            <select id="videoBitrateOp" class="form-select" name="videoBitrateOp" aria-label="Video bitrate rule" style="max-width: 150px;">
              <option value=">=">at least (> =)</option>
              <option value="<=">at most (<=)</option>
              <option value="=" selected>about (=)</option>
            </select>
            <input id="videoBitrate" class="form-control" name="videoBitrate" type="number" min="1" step="1" value="6000" placeholder="6000" />
            <span class="input-group-text">k</span>
          </div>
        </div>
        <div class="col-md-3">
          <label for="audioCodec" class="form-label">Audio codec</label>
          <select id="audioCodec" class="form-select" name="audioCodec">
            <option value="">Any</option>
          </select>
        </div>
        <div class="col-md-3">
          <label for="audioChannels" class="form-label">Audio channels</label>
          <div class="input-group">
            <select id="audioChannelsOp" class="form-select" name="audioChannelsOp" aria-label="Audio channels rule" style="max-width: 150px;">
              <option value=">=">at least (> =)</option>
              <option value="<=">at most (<=)</option>
              <option value="=" selected>exact (=)</option>
            </select>
            <select id="audioChannels" class="form-select" name="audioChannels">
              <option value="">Any</option>
              <option value="1">1 (Mono)</option>
              <option value="2">2 (Stereo)</option>
              <option value="6" selected>6 (5.1)</option>
              <option value="8">8 (7.1)</option>
            </select>
          </div>
        </div>
        <div class="col-12 d-flex align-items-center gap-2 justify-content-end">
          <button id="run-btn" class="btn btn-primary" type="submit">Scan Files</button>
          <button id="cancel-scan-btn" class="btn btn-outline-danger d-none" type="button">Cancel Scan</button>
        </div>
      </form>
      </div>
    </div>
  </div>
  <div id="output-panel-anchor"></div>

  <div class="card mt-3">
    <div class="card-header fw-bold d-flex align-items-center justify-content-between gap-2">
      <span class="d-inline-flex align-items-center gap-2">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="bi bi-table" viewBox="0 0 16 16" aria-hidden="true" focusable="false">
          <path d="M0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2zm15 2H1v3h14zm0 4H1v3h14zm0 4H1v2a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1z"/>
        </svg>
        <span>Scanned Files</span>
      </span>
      <div class="d-flex align-items-center gap-3">
        <div class="form-check m-0">
          <input class="form-check-input" type="checkbox" id="delete-original" name="deleteOriginal" checked />
          <label class="form-check-label small" for="delete-original">Delete original after transcode</label>
        </div>
        <button id="transcode-btn" class="btn btn-success" type="button">Transcode</button>
      </div>
    </div>
    <div class="card-body p-0">
      <div id="results-table-wrap" class="table-responsive">
        <table id="results-table" class="table table-bordered table-sm align-middle mb-0">
      <thead class="table-light">
        <tr>
          <th># <span class="sort-icon" title="Sort">⇅</span></th>
          <th>Status <span class="sort-icon" title="Sort">⇅</span></th>
          <th>Size (MB) <span class="sort-icon" title="Sort">⇅</span></th>
          <th>V Codec <span class="sort-icon" title="Sort">⇅</span></th>
          <th>V Bitrate (K) <span class="sort-icon" title="Sort">⇅</span></th>
          <th>A Codec <span class="sort-icon" title="Sort">⇅</span></th>
          <th>A Ch <span class="sort-icon" title="Sort">⇅</span></th>
          <th>Issues <span class="sort-icon" title="Sort">⇅</span></th>
          <th>File <span class="sort-icon" title="Sort">⇅</span></th>
          <th>Actions</th>
          <th><input type="checkbox" id="select-all-checkbox" title="Select all" /></th>
        </tr>
      </thead>
      <tbody id="results-body">
        <tr><td colspan="11" class="text-muted">Scan files to see results.</td></tr>
      </tbody>
        </table>
      </div>
    </div>
  </div>
</main>

<div class="modal fade" id="detailsModal" tabindex="-1" aria-labelledby="detailsModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="detailsModalLabel">File Details</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="mb-3">
          <div class="fw-semibold">File</div>
          <div id="detailsFilePath" class="text-break"></div>
        </div>
        <div class="mb-3">
          <span id="detailsStatusBadge" class="badge text-bg-secondary">STATUS</span>
          <span id="detailsIssueBadge" class="badge text-bg-dark ms-2">0 issues</span>
        </div>
        <div>
          <div class="fw-semibold mb-2">Details</div>
          <ul id="detailsList" class="list-group"></ul>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="deleteOriginalWarningModal" tabindex="-1" aria-labelledby="deleteOriginalWarningModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="deleteOriginalWarningModalLabel">Delete Original Files?</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="alert alert-warning mb-0" role="alert">
          This cannot be undone. Original source files will be deleted after successful transcode.
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" id="confirm-delete-original-btn" class="btn btn-danger">Yes, Delete Originals</button>
      </div>
    </div>
  </div>
</div>

<script src="https://unpkg.com/tablesort@5.3.0/dist/tablesort.min.js"></script>
<script src="https://unpkg.com/tablesort@5.3.0/dist/sorts/tablesort.number.min.js"></script>
<script type="module" src="/js/app.js"></script>
